# 04.文件归档和文件备份实操

创建一些文件和文件夹

```bash
touch file1 file2 file3
mkdir {dir1,dir2,dir3}
```

## 压缩

把他们打包

```bash
$ tar cf pack-$(date +%Y%m%d).tar file2 file3 dir2 dir3
$ tar tvf pack-20231111.tar 
file2
file3
dir2/
dir3/
```

* v 详细信息
* c 创建
* f 文件名
* t 查看
* 注意压缩包的名字和我的不同

压缩

```bash
$ tar czf pack-$(date +%Y%m%d).tar.gz file1 dir1
$ tar tvf pack-20231111.tar.gz 
-rw-r--r-- root/root         0 2023-11-11 00:48 file1
drwxr-xr-x root/root         0 2023-11-11 00:48 dir1/
```

## 解压

删掉创建的文件和文件夹，为了解压的时候能看到

```bash
$ rm -rf file* dir*
$ ls
```

解压

```bash
$ tar tvf pack-20231111.tar.gz 
file1
dir1/
$ tar tvf pack-20231111.tar
file2
file3
dir2/
dir3/
```

解压可使用`ls`可以看到解压成功后的文件和文件夹。

## zip包

一般要用`tar.gz`包传输，但是`windows`不识别，所以要搞成`zip`包。命令如下：

```bash
zip -r xxx.zip ./*
unzip xxx.zip
```

思考题：还记得`ls`和`rm`命令吗？

## 文档传输

**方式一、sftp**

![](https://coding3min.oss-accelerate.aliyuncs.com/uPic/20231111/17-18-44-SiFwOI.png)

压缩以后肯定是为了传输的。有两种方式，执行此命令，需要把`ip`替换成当前测试的服务器`ip`。

```bash
sftp root@ip:/etc/hosts
```

这样就把`hosts`文件下下来了（此文件配置了域名和ip的映射关系），可以看到在当前目录出现了一个`hosts`文件。

我们还可以进入`sftp`交互，进入后可以执行命令。

```BASH
$ sftp root@ip
root@ip's password: 
Connected to ip.
sftp> pwd
Remote working directory: /root
sftp> ls
Changelog              file-20231111.tar      file-20231111.tar.gz   hosts                  mem_free 
sftp> lmkdir /tmp/shell
sftp> lcd /tmp/shell
sftp> lpwd
Local working directory: /tmp/shell
```

* `pwd` 查看`sftp`连接的远程服务器当前位置。
* `ls`查看远程服务器当前目录下的内容。
* `lmkdir` 在本地服务器创建目录。
* `lcd`本地服务器进入目录。
* `lpwd`本地服务器查看当前目录内容。
* 所以可以看出这此命令前面的`l`代表`local`的意思。

下载文件

```BASH
sftp> get file-20231111.tar
Fetching /root/file-20231111.tar to file-20231111.tar
sftp> lls
file-20231111.tar
```

上传文件

```BASH
sftp> put /etc/yum.conf 
Uploading /etc/yum.conf to /root/yum.conf
/etc/yum.conf  
sftp> ls
Changelog              file-20231111.tar      file-20231111.tar.gz   hosts                  mem_free               yum.conf 
```

退出

```BASH
sftp> exit
```


**方式二、scp**

scp用得最广泛。用法也简单，只有上传和下载。

下载文件

```BASH
$ mkdir scp
$ cd scp
$ scp root@ip:/root/file-20231111.tar.gz .
root@ip's password: 
file-20231111.tar.gz                                                                                                                                    100%  138   453.8KB/s   00:00    
$ ls
file-20231111.tar.gz
```

上传文件

```BASH
$ touch uploadfile 
$ scp uploadfile root@ip:/root/
$ ls /root | grep upl
uploadfile
```

批量上传

```BASH
$ scp -r /root root@ip:/tmp/shell/
root@ip's password: 
Permission denied, please try again.
root@ip's password: 
pip.conf                                                                                                                                                100%  103   109.6KB/s   00:00    
.viminfo                                                                                                                                                100%  838     2.2MB/s   00:00    
known_hosts                                                                                                                                             100%  176   518.9KB/s   00:00    
authorized_keys                                                                                                                                         100%    0     0.0KB/s   00:00    
mem_free                                                                                                                                                100%   60KB  40.4MB/s   00:00    
.cshrc                                                                                                                                                  100%  100   122.2KB/s   00:00    
file-20231111.tar.gz                                                                                                                                    100%  138   433.8KB/s   00:00    
Changelog                                                                                                                                               100%   96KB  50.1MB/s   00:00    
.bash_history                                                                                                                                           100% 1030     3.2MB/s   00:00    
.tcshrc                                                                                                                                                 100%  129   211.8KB/s   00:00    
yum.conf                                                                                                                                                100%  108   331.0KB/s   00:00    
file-20231111.tar.gz                                                                                                                                    100%  138   424.0KB/s   00:00    
uploadfile                                                                                                                                              100%    0     0.0KB/s   00:00    
hosts                                                                                                                                                   100%    0     0.0KB/s   00:00    
.bash_profile                                                                                                                                           100%  176   519.7KB/s   00:00    
uploadfile                                                                                                                                              100%    0     0.0KB/s   00:00    
file-20231111.tar                                                                                                                                       100%    0     0.0KB/s   00:00    
.bashrc                                                                                                                                                 100%  216   634.6KB/s   00:00    
```


思考：你知道批量下载怎么做吗？


## 系统间同步








